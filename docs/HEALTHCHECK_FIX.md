# Docker å¥åº·æ£€æŸ¥ä¿®å¤æŒ‡å—

## ğŸš¨ é—®é¢˜æè¿°

ç”¨æˆ·æŠ¥å‘Š Docker å®¹å™¨å¥åº·æ£€æŸ¥å¤±è´¥ï¼Œæ˜¾ç¤ºé”™è¯¯ï¼š
```
http://localhost:8080/: Remote file does not exist -- broken link!!
```

è™½ç„¶åº”ç”¨åŠŸèƒ½æ­£å¸¸ï¼Œä¸‹è½½å·¥ä½œæ­£å¸¸ï¼Œä½† Docker å¥åº·æ£€æŸ¥æŒç»­å¤±è´¥ã€‚

## ğŸ” é—®é¢˜åˆ†æ

### æ ¹æœ¬åŸå› 
1. **å¥åº·æ£€æŸ¥ç«¯ç‚¹ä¸åˆé€‚** - åŸæ¥ä½¿ç”¨æ ¹è·¯å¾„ `/` è¿›è¡Œå¥åº·æ£€æŸ¥
2. **å¯åŠ¨æ—¶é—´ä¸è¶³** - åº”ç”¨éœ€è¦æ›´é•¿æ—¶é—´å®Œå…¨å¯åŠ¨
3. **æ£€æŸ¥æ–¹å¼ä¸å½“** - ä½¿ç”¨ `wget --spider` å¯èƒ½ä¸é€‚åˆæ£€æŸ¥åŠ¨æ€å†…å®¹

### æŠ€æœ¯ç»†èŠ‚
- åº”ç”¨ä½¿ç”¨çº¯ JavaScript + HTMLï¼Œä¸ä¾èµ– Vue.js æ„å»º
- æ ¹è·¯å¾„ `/` è¿”å›å®Œæ•´çš„ HTML é¡µé¢ï¼Œå¯èƒ½åŒ…å«åŠ¨æ€å†…å®¹
- å¥åº·æ£€æŸ¥åº”è¯¥ä½¿ç”¨ç®€å•çš„ API ç«¯ç‚¹

## ğŸ”§ ä¿®å¤æ–¹æ¡ˆ

### 1. æ·»åŠ ä¸“ç”¨å¥åº·æ£€æŸ¥ç«¯ç‚¹

åœ¨ `main.go` ä¸­æ·»åŠ äº†æ–°çš„ `/health` ç«¯ç‚¹ï¼š

```go
// å¥åº·æ£€æŸ¥ç«¯ç‚¹ - ç®€å•çš„ JSON å“åº”
r.GET("/health", func(c *gin.Context) {
    c.JSON(http.StatusOK, gin.H{
        "status":  "ok",
        "service": "lazybala",
    })
})
```

### 2. æ›´æ–° Dockerfile å¥åº·æ£€æŸ¥

```dockerfile
# å¥åº·æ£€æŸ¥ - ä½¿ç”¨ä¸“ç”¨çš„å¥åº·æ£€æŸ¥ç«¯ç‚¹
HEALTHCHECK --interval=30s --timeout=10s --start-period=60s --retries=3 \
  CMD curl -f http://localhost:8080/health || wget --no-verbose --tries=1 --spider http://localhost:8080/health || exit 1
```

**å…³é”®æ”¹è¿›**ï¼š
- ä½¿ç”¨ `/health` ç«¯ç‚¹æ›¿ä»£æ ¹è·¯å¾„ `/`
- å¢åŠ å¯åŠ¨ç­‰å¾…æ—¶é—´ï¼š`start-period=60s`ï¼ˆä» 30s å¢åŠ åˆ° 60sï¼‰
- ä¿ç•™ curl å’Œ wget åŒé‡æ£€æŸ¥æœºåˆ¶

### 3. æ›´æ–° docker-compose.yml

```yaml
healthcheck:
  test: ["CMD", "sh", "-c", "curl -f http://localhost:8080/health || wget --no-verbose --tries=1 --spider http://localhost:8080/health"]
  interval: 30s
  timeout: 10s
  retries: 3
  start_period: 60s
```

## ğŸ“‹ éªŒè¯æ­¥éª¤

### 1. æ‰‹åŠ¨æµ‹è¯•å¥åº·æ£€æŸ¥ç«¯ç‚¹

```bash
# æµ‹è¯•æ–°çš„å¥åº·æ£€æŸ¥ç«¯ç‚¹
curl http://localhost:8080/health

# é¢„æœŸå“åº”
{"service":"lazybala","status":"ok"}
```

### 2. æ£€æŸ¥ Docker å¥åº·çŠ¶æ€

```bash
# æŸ¥çœ‹å®¹å™¨å¥åº·çŠ¶æ€
docker ps

# æŸ¥çœ‹è¯¦ç»†å¥åº·æ£€æŸ¥ä¿¡æ¯
docker inspect --format='{{.State.Health}}' lazybala

# æŸ¥çœ‹å¥åº·æ£€æŸ¥æ—¥å¿—
docker inspect --format='{{range .State.Health.Log}}{{.Output}}{{end}}' lazybala
```

### 3. ä½¿ç”¨æµ‹è¯•è„šæœ¬

```bash
# è¿è¡Œå®Œæ•´æµ‹è¯•
./scripts/test-docker-fix.sh

# æˆ–æ‰‹åŠ¨æµ‹è¯•
docker-compose down
docker-compose build --no-cache
docker-compose up -d
```

## ğŸ¯ é¢„æœŸç»“æœ

ä¿®å¤åï¼Œç”¨æˆ·åº”è¯¥çœ‹åˆ°ï¼š

1. **å¥åº·æ£€æŸ¥é€šè¿‡** - Docker å®¹å™¨çŠ¶æ€æ˜¾ç¤ºä¸º `healthy`
2. **åº”ç”¨æ­£å¸¸å·¥ä½œ** - æ‰€æœ‰åŠŸèƒ½åŒ…æ‹¬ä¸‹è½½ç»§ç»­æ­£å¸¸å·¥ä½œ
3. **æ— é”™è¯¯æ—¥å¿—** - ä¸å†æœ‰ "broken link" é”™è¯¯ä¿¡æ¯

## ğŸ” æ•…éšœæ’é™¤

### å¦‚æœå¥åº·æ£€æŸ¥ä»ç„¶å¤±è´¥

1. **æ£€æŸ¥åº”ç”¨å¯åŠ¨æ—¥å¿—**ï¼š
   ```bash
   docker-compose logs -f lazybala
   ```

2. **æ‰‹åŠ¨æµ‹è¯•ç«¯ç‚¹**ï¼š
   ```bash
   # è¿›å…¥å®¹å™¨æµ‹è¯•
   docker exec -it lazybala sh
   curl http://localhost:8080/health
   wget -O- http://localhost:8080/health
   ```

3. **æ£€æŸ¥ç«¯å£ç»‘å®š**ï¼š
   ```bash
   # ç¡®è®¤ç«¯å£æ­£ç¡®æ˜ å°„
   docker port lazybala
   netstat -tlnp | grep 8080
   ```

4. **å¢åŠ å¯åŠ¨ç­‰å¾…æ—¶é—´**ï¼š
   ```yaml
   healthcheck:
     start_period: 120s  # å¢åŠ åˆ° 2 åˆ†é’Ÿ
   ```

### å¸¸è§é—®é¢˜

**Q: ä¸ºä»€ä¹ˆä¸ç›´æ¥ä½¿ç”¨æ ¹è·¯å¾„ `/` è¿›è¡Œå¥åº·æ£€æŸ¥ï¼Ÿ**
A: æ ¹è·¯å¾„è¿”å›å®Œæ•´çš„ HTML é¡µé¢ï¼Œå¯èƒ½åŒ…å«åŠ¨æ€å†…å®¹å’Œå¤–éƒ¨èµ„æºå¼•ç”¨ï¼Œä¸é€‚åˆç®€å•çš„å¥åº·æ£€æŸ¥ã€‚

**Q: å¥åº·æ£€æŸ¥å¤±è´¥ä¼šå½±å“åº”ç”¨åŠŸèƒ½å—ï¼Ÿ**
A: ä¸ä¼šã€‚å¥åº·æ£€æŸ¥åªæ˜¯ Docker çš„ç›‘æ§æœºåˆ¶ï¼Œå¤±è´¥ä¸ä¼šå½±å“åº”ç”¨æœ¬èº«çš„åŠŸèƒ½ã€‚

**Q: å¯ä»¥ç¦ç”¨å¥åº·æ£€æŸ¥å—ï¼Ÿ**
A: å¯ä»¥ï¼Œä½†ä¸æ¨èã€‚å¥åº·æ£€æŸ¥æœ‰åŠ©äºç›‘æ§å’Œè‡ªåŠ¨æ¢å¤ã€‚

## ğŸ“ æ”¯æŒ

å¦‚æœé—®é¢˜ä»ç„¶å­˜åœ¨ï¼š

1. æŸ¥çœ‹ [GitHub Issues](https://github.com/kis2show/lazybala/issues)
2. æäº¤æ–°çš„ Issue å¹¶é™„ä¸Šï¼š
   - Docker ç‰ˆæœ¬ä¿¡æ¯
   - å®¹å™¨æ—¥å¿—
   - å¥åº·æ£€æŸ¥è¯¦ç»†ä¿¡æ¯
   - ç³»ç»Ÿç¯å¢ƒä¿¡æ¯
